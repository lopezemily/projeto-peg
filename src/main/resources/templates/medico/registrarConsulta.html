<!doctype html>
<html lang="pt-br" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/autenticado}">

    <head>
        <title>Consulta</title>
    </head>

    <body>
        <div class="container" layout:fragment="content">

            <div  class="form-row col-sm align-items-center">
                <img th:src="@{/img/prontuario.png}"/>
                <h4>Registro de Prontuário</h4>
            </div>

            <form th:action="@{/medico/atender/} + ${numeroAtendimento}" method="post" id="formProntuario">
                <div class="blockwhite" id="espacotitulo">
                    <div class="form-row">
                        <div class="col-sm-3">
                            <label for="numAtendimentoPront">Nº atendimento</label>
                            <input id="numAtendimentoPront" type="number" class="form-control" readonly th:value="${numeroAtendimento}">
                        </div>
                    </div>
                    <div class="form-row">
                        <label for="queixaPront">Queixa principal</label>
                        <input id="queixaPront" type="text" class="form-control" required name="queixa">
                    </div>


                    <div class="form-row align-items-end">

                        <input name="cids" type="hidden">

                            <div id="cids" class="form-row align-items-end col-sm">
                                <div class="col-sm-3">
                                    <label for="cid">Buscar CID</label>
                                    <input id="cid" type="text" class="form-control cid" placeholder="ex: J15.9">
                                </div>
                                <div class="col-sm-9">
                                    <input id="cidDescricao" type="text" readonly class="form-control"> 
                                </div>
                            </div>

                            <div class="col-sm-auto">
                                <button class="btn btn-primary" type="button" id="adicionar_cid" name="cids.descricao">ADD</button>
                            </div>

                    </div>


                    <div class="form-row align-items-center">
                        <div class="col-sm-3">
                            <label for="paPront">PA</label>
                            <input id="paPront" type="text" placeholder="ex: 120x80" class="form-control" name="pa">
                        </div>
                        <div class="col-sm-3">
                            <label for="frPront">FR</label>
                            <input id="frPront" type="number" class="form-control" name="fr">
                        </div>
                        <div class="col-sm-3">
                            <label for="temperaturaPront">Temperatura</label>
                            <input id="temperaturaPront" type="number" class="form-control" name="temperatura">
                        </div>
                        <div class="col-sm-3">
                            <label for="pesoPront">Peso</label>
                            <input id="pesoPront" type="number" class="form-control" name="peso">
                        </div>
                    </div>
                    <div class="form-row">
                        <label for="avaliacao">Avaliação</label>
                        <textarea id="avaliacao" class="form-control" rows="3" required name="avalMedico"></textarea>
                    </div>
                    <div class="form-row">
                        <label for="examesPront">Exames</label>
                        <textarea id="examesPront" class="form-control" placeholder="Ex: Hemograma, Glicemia, Colesterol total" rows="2" name="exames"></textarea>
                    </div><p></p>
                    <div class="row justify-content-end">
                        <div class="col-sm-3">
                            <button type="submit" id="btnSalvar" class="btn btn-success btnAlt">Finalizar</button>
                        </div>
                        <div class="col-sm-3">
                            <form th:action="@{/medico/receita/} + ${numAtendimento}" method="get">
                                <button type="submit"id="btnReceita" class="btn btnAlt">Receita</button>
                            </form>
                        </div>
                        <div class="col-sm-3">
                            <form th:action="@{/medico/atestado/} + ${numAtendimento}" method="get">
                                <button type="submit" id="btnAtestado" class="btn btnAlt">Atestado</button>
                            </form>
                        </div>
                    </div>
                </div>
            </form>

        </div>
        <div layout:fragment="scripts">
            <script>
                //adicionar cid
                $("#adicionar_cid").click(function () {
                    var campos_novos = "<div class='cid_fc row'>\n\
                                        <div class='col-sm' style='margin-top: 5px;'>\n\
                                        <input type='text' class='form-control cid' id='cid'>\n\
                                        </div>\n\
                                        <div class='col-sm' style='margin-top: 5px;'>\n\
                                        <input type='text' class='form-control' id='cidDescricao' name='cids.descricao' readonly type='button'>\n\
                                        </div>\n\
                                        <div class='col-sm-4' id='cid_fc' style='margin-top: 5px;'>\n\
                                        <button class='btn btn-primary remove' type='button' >Remove</button>\n\
                                        </div></div>";
                    $("#cids").append(campos_novos);
                });

                $(document).on('click', 'button.remove', function () {
                    $(this).closest('div.cid_fc').remove();
                });

                function processarForm(e) {
                    e.preventDefault();
                    
                    var cids="";
                    $(".cid").each(function (i, e) {
                        cids = cids + $(this).val() + ",";
                    });
                    console.log(cids);
                }

                $("#formProntuario").on("submit", processarForm);

            </script>
        </div>
    </body>

</html>